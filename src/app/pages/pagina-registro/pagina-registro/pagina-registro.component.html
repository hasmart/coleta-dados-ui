<section class="content-header">
  <div id="divtitle">
    <label id="labelNome">Registro de Relatos</label>
    <label id="labelVisualize"
      >Pesquise com o código do paciente para consultar registros ou cadastrar
      um novo registro</label
    >
  </div>
</section>

<section class="content-body">
  <label style="position: relative; bottom: 43px; right: 46px; font-size: 21px"
    >Consulta de Relatos</label
  >
  <div
    class="searchReg"
    style="padding: 16px 377px; position: relative; width: 100%"
  >
    <div class="search-bar shadow p-3 mb-5 bg-white rounded" style="width: 80%">
      <input
        type="text"
        class="searchTerm"
        placeholder="Digite aqui..."
        style="height: 10%"
        (keyup)="onKeyUp($event)"
      />
      <button
        type="submit"
        class="searchButton"
        id="searchButton"
        placeholder=""
        (click)="onSubmit()"
      >
        <i class="fa fa-search"></i>
      </button>
    </div>
    <div class="icons" style="float: right; padding: 15px">
      <mat-icon>edit</mat-icon>
      <mat-icon>delete</mat-icon>
    </div>
  </div>
  <div class="tableReg">
    <table
      mat-table
      [dataSource]="dataSource"
      class="mat-elevation-z8"
      style="width: 100%"
    >
      <!-- Checkbox Column -->
      <ng-container matColumnDef="select" style="width: 16.667%">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox
            (change)="$event ? masterToggle() : null"
            [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()"
          >
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let row">
          <mat-checkbox
            (click)="$event.stopPropagation()"
            (change)="$event ? selection.toggle(row) : null"
            [checked]="selection.isSelected(row)"
          >
          </mat-checkbox>
        </td>
      </ng-container>

      <!-- Relator Column -->
      <ng-container matColumnDef="relator" style="width: 16.667%">
        <th mat-header-cell *matHeaderCellDef>Relator</th>
        <td mat-cell *matCellDef="let element">
          <mat-icon
            style="max-width: 40px; max-height: 40px"
            *ngIf="
              buscado == element.tipoRelato ||
              buscado == element.relator ||
              buscado == element.anomizado
            "
            >account_circle</mat-icon
          >
        </td>
      </ng-container>

      <!-- Tipo Relato Column -->
      <ng-container matColumnDef="tipoRelato" style="width: 16.667%">
        <th mat-header-cell *matHeaderCellDef>Tipo de Relato</th>
        <td mat-cell *matCellDef="let element">
          <img
            src="../../../../assets/dist/img/telefone.png"
            *ngIf="
              buscado == element.tipoRelato ||
              buscado == element.relator ||
              buscado == element.anomizado
            "
            style="max-width: 40px; max-height: 40px"
          />
        </td>
      </ng-container>

      <!-- Anomizado Column -->
      <ng-container matColumnDef="anomizado" style="width: 16.667%">
        <th mat-header-cell *matHeaderCellDef>Anomizado</th>
        <td mat-cell *matCellDef="let element">
          <p
            *ngIf="
              buscado == element.tipoRelato ||
              buscado == element.relator ||
              buscado == element.anomizado
            "
          >
            {{ element.anomizado }}
          </p>
        </td>
      </ng-container>

      <!-- Data Column -->
      <ng-container matColumnDef="time" style="width: 16.667%">
        <th mat-header-cell *matHeaderCellDef>Data/Hora</th>
        <td mat-cell *matCellDef="let element">
          <p
            *ngIf="
              buscado == element.tipoRelato ||
              buscado == element.relator ||
              buscado == element.anomizado
            "
          >
            {{ element.time }}
          </p>
        </td>
      </ng-container>

      <!-- Relato Column -->
      <ng-container matColumnDef="relato" style="width: 16.667%">
        <th mat-header-cell *matHeaderCellDef>Relato</th>
        <td mat-cell *matCellDef="let element">
          <button
            mat-icon-button
            data-toggle="modal"
            data-target="#exampleModal"
            *ngIf="
              buscado == element.tipoRelato ||
              buscado == element.relator ||
              buscado == element.anomizado
            "
          >
            <mat-icon aria-hidden="false">expand_more</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        (click)="selection.toggle(row)"
      ></tr>
    </table>
  </div>

  <div class="box box-default" id="medicaoBox">
    <div>
      <label id="medicaoTitleLabel">Relatório </label>
    </div>
    <div id="tabela" *ngIf="cidadao$ | async">
      <p>
        <mat-form-field
          mat-form-field
          style="margin-left: 3%; width: 94%"
          class="example-full-width"
        >
          <textarea
            matInput
            style="width: 100%"
            rows="15"
            [(ngModel)]="relatorio"
            placeholder="Digite aqui o relatório..."
          ></textarea>
        </mat-form-field>
      </p>
    </div>
  </div>

  <button
    mat-button
    id="finalizarButton"
    data-toggle="modal"
    data-target="#okcidadao"
    (click)="CadastraRelatorio()"
    *ngIf="relatorio"
  >
    <label id="retornoCidadaoButtonLabel">FINALIZAR RELATÓRIO</label>
  </button>
  <!--*ngIf=peso -->
  <button mat-button id="finalizarButtonBlocked" *ngIf="!relatorio">
    <label id="retornoCidadaoButtonLabel">FINALIZAR RELATÓRIO</label>
  </button>
  <div class="modal fade" id="okcidadao" *ngIf="valid && !errorBye">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title" id="titleModal">Sucesso!</h4>
        </div>

        <!-- Modal body -->
        <div class="modal-body">
          <label id="modalText"
            >Cidadão com CPF {{ showingCpf }} teve um relatório
            adicionado!</label
          >
          <button
            mat-button
            id="okbutton"
            data-dismiss="modal"
            (click)="goToView()"
          >
            <label id="oklabel">OK</label>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div
    class="modal fade"
    id="exampleModal"
    tabindex="-1"
    role="dialog"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog" role="document">
      <div
        class="modal-content"
        style="
          width: 167%;
          padding: -17%;
          /* margin: -20%; */
          margin-left: -25%;
        "
      >
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel"></h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <app-info-relato></app-info-relato>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Close
          </button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>
</section>
